
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the Charli3 Dendrite project.">
      
      
      
        <link rel="canonical" href="https://charli3.io/amm_base/">
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../types/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.32">
    
    
      
        <title>Amm base - Charli3 Dendrite</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="red" data-md-color-accent="pink">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#charli3_dendrite.dexs.amm.amm_base" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Charli3 Dendrite" class="md-header__button md-logo" aria-label="Charli3 Dendrite" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Charli3 Dendrite
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Amm base
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Charli3-Official/charli3-dendrite" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Charli3-Official/charli3-dendrite
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Charli3 Dendrite" class="md-nav__button md-logo" aria-label="Charli3 Dendrite" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Charli3 Dendrite
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Charli3-Official/charli3-dendrite" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Charli3-Official/charli3-dendrite
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    DEXs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            DEXs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Automated Market Maker
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Automated Market Maker
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Amm base
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Amm base
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base" class="md-nav__link">
    <span class="md-ellipsis">
      amm_base
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base.AbstractPoolState" class="md-nav__link">
    <span class="md-ellipsis">
      AbstractPoolState
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AbstractPoolState">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.pool_datum" class="md-nav__link">
    <span class="md-ellipsis">
      pool_datum
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.pool_id" class="md-nav__link">
    <span class="md-ellipsis">
      pool_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.price" class="md-nav__link">
    <span class="md-ellipsis">
      price
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.tvl" class="md-nav__link">
    <span class="md-ellipsis">
      tvl
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.extract_dex_nft" class="md-nav__link">
    <span class="md-ellipsis">
      extract_dex_nft
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.extract_lp_tokens" class="md-nav__link">
    <span class="md-ellipsis">
      extract_lp_tokens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.extract_pool_nft" class="md-nav__link">
    <span class="md-ellipsis">
      extract_pool_nft
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.lp_policy" class="md-nav__link">
    <span class="md-ellipsis">
      lp_policy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.pool_datum_class" class="md-nav__link">
    <span class="md-ellipsis">
      pool_datum_class
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.pool_policy" class="md-nav__link">
    <span class="md-ellipsis">
      pool_policy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.post_init" class="md-nav__link">
    <span class="md-ellipsis">
      post_init
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.skip_init" class="md-nav__link">
    <span class="md-ellipsis">
      skip_init
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.swap_datum" class="md-nav__link">
    <span class="md-ellipsis">
      swap_datum
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.swap_utxo" class="md-nav__link">
    <span class="md-ellipsis">
      swap_utxo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.translate_address" class="md-nav__link">
    <span class="md-ellipsis">
      translate_address
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Types
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_3" >
        
          
          <label class="md-nav__link" for="__nav_2_1_3" id="__nav_2_1_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Modules
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_3">
            <span class="md-nav__icon md-icon"></span>
            Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../vyfi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vyfi
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../minswap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Minswap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../muesliswap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Muesliswap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spectrum/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spectrum
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sundae/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sundae
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../wingriders/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Wingriders
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Order Book
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Order Book
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../order_book_base/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Order book base
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2_2" id="__nav_2_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Modules
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_2">
            <span class="md-nav__icon md-icon"></span>
            Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../axo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Axo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geniusyield/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Genius Yield
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Core
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core_base/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core base
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../errors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Errors
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Backend
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Backend
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../backend_base/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Backend Base
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Utils
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    DBsync
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            DBsync
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dbsync_models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Models
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Data Classes
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Data Classes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../datums/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Datums
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Models
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base" class="md-nav__link">
    <span class="md-ellipsis">
      amm_base
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base.AbstractPoolState" class="md-nav__link">
    <span class="md-ellipsis">
      AbstractPoolState
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AbstractPoolState">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.pool_datum" class="md-nav__link">
    <span class="md-ellipsis">
      pool_datum
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.pool_id" class="md-nav__link">
    <span class="md-ellipsis">
      pool_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.price" class="md-nav__link">
    <span class="md-ellipsis">
      price
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.tvl" class="md-nav__link">
    <span class="md-ellipsis">
      tvl
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.extract_dex_nft" class="md-nav__link">
    <span class="md-ellipsis">
      extract_dex_nft
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.extract_lp_tokens" class="md-nav__link">
    <span class="md-ellipsis">
      extract_lp_tokens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.extract_pool_nft" class="md-nav__link">
    <span class="md-ellipsis">
      extract_pool_nft
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.lp_policy" class="md-nav__link">
    <span class="md-ellipsis">
      lp_policy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.pool_datum_class" class="md-nav__link">
    <span class="md-ellipsis">
      pool_datum_class
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.pool_policy" class="md-nav__link">
    <span class="md-ellipsis">
      pool_policy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.post_init" class="md-nav__link">
    <span class="md-ellipsis">
      post_init
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.skip_init" class="md-nav__link">
    <span class="md-ellipsis">
      skip_init
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.swap_datum" class="md-nav__link">
    <span class="md-ellipsis">
      swap_datum
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.swap_utxo" class="md-nav__link">
    <span class="md-ellipsis">
      swap_utxo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.translate_address" class="md-nav__link">
    <span class="md-ellipsis">
      translate_address
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>Amm base</h1>

<div class="doc doc-object doc-module">



<a id="charli3_dendrite.dexs.amm.amm_base"></a>
    <div class="doc doc-contents first">

      <p>Module providing base classes for AMM pools.</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="charli3_dendrite.dexs.amm.amm_base.AbstractPoolState" class="doc doc-heading">
            <code>AbstractPoolState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="charli3_dendrite.dexs.core.base.AbstractPairState" href="../core_base/#charli3_dendrite.dexs.core.base.AbstractPairState">AbstractPairState</a></code></p>


      <p>Abstract class representing the state of a pool in an exchange.</p>

              <details class="quote">
                <summary>Source code in <code>src/charli3_dendrite/dexs/amm/amm_base.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AbstractPoolState</span><span class="p">(</span><span class="n">AbstractPairState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract class representing the state of a pool in an exchange.&quot;&quot;&quot;</span>

    <span class="n">datum_cbor</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">datum_hash</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">inactive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">lp_tokens</span><span class="p">:</span> <span class="n">Assets</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">pool_nft</span><span class="p">:</span> <span class="n">Assets</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">tx_index</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">tx_hash</span><span class="p">:</span> <span class="nb">str</span>

    <span class="n">_batcher_fee</span><span class="p">:</span> <span class="n">Assets</span>
    <span class="n">_datum_parsed</span><span class="p">:</span> <span class="n">PlutusData</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_deposit</span><span class="p">:</span> <span class="n">Assets</span>
    <span class="n">_volume_fee</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">pool_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A unique identifier for the pool.</span>

<span class="sd">        This is a unique string differentiating this pool from every other pool on the</span>
<span class="sd">        dex, and is necessary for dexs that have more than one pool for a pair but with</span>
<span class="sd">        different fee structures.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Unique pool id is not specified.&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">pool_datum_class</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">type</span><span class="p">[</span><span class="n">PlutusData</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The class type for the pool datum.</span>

<span class="sd">        This property should be implemented to return the specific PlutusData subclass</span>
<span class="sd">        that represents the datum for the pool.</span>

<span class="sd">        Returns:</span>
<span class="sd">            type[PlutusData]: The class type for the pool datum.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pool_datum</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PlutusData</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The pool state datum.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool_datum_class</span><span class="p">()</span><span class="o">.</span><span class="n">from_cbor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datum_cbor</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">swap_datum</span><span class="p">(</span>  <span class="c1"># noqa: PLR0913</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">address_source</span><span class="p">:</span> <span class="n">Address</span><span class="p">,</span>
        <span class="n">in_assets</span><span class="p">:</span> <span class="n">Assets</span><span class="p">,</span>
        <span class="n">out_assets</span><span class="p">:</span> <span class="n">Assets</span><span class="p">,</span>
        <span class="n">extra_assets</span><span class="p">:</span> <span class="n">Assets</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">address_target</span><span class="p">:</span> <span class="n">Address</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">datum_target</span><span class="p">:</span> <span class="n">PlutusData</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PlutusData</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a swap datum for the pool.</span>

<span class="sd">        Args:</span>
<span class="sd">            address_source (Address): The source address for the swap.</span>
<span class="sd">            in_assets (Assets): The assets being swapped in.</span>
<span class="sd">            out_assets (Assets): The assets being swapped out.</span>
<span class="sd">            extra_assets (Assets | None, optional): Any additional assets involved.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">            address_target (Address | None, optional): The target address for the swap.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">            datum_target (PlutusData | None, optional): The target datum for the swap.</span>
<span class="sd">            Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            PlutusData: The created swap datum.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If more than one asset is supplied as input or output.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">swap_forward</span> <span class="ow">and</span> <span class="n">address_target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>  <span class="c1"># noqa: T201</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> does not support swap forwarding.&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_datum_class</span><span class="p">()</span><span class="o">.</span><span class="n">create_datum</span><span class="p">(</span>
            <span class="n">address_source</span><span class="o">=</span><span class="n">address_source</span><span class="p">,</span>
            <span class="n">in_assets</span><span class="o">=</span><span class="n">in_assets</span><span class="p">,</span>
            <span class="n">out_assets</span><span class="o">=</span><span class="n">out_assets</span><span class="p">,</span>
            <span class="n">batcher_fee</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batcher_fee</span><span class="p">(</span>
                <span class="n">in_assets</span><span class="o">=</span><span class="n">in_assets</span><span class="p">,</span>
                <span class="n">out_assets</span><span class="o">=</span><span class="n">out_assets</span><span class="p">,</span>
                <span class="n">extra_assets</span><span class="o">=</span><span class="n">extra_assets</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">deposit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deposit</span><span class="p">(</span><span class="n">in_assets</span><span class="o">=</span><span class="n">in_assets</span><span class="p">,</span> <span class="n">out_assets</span><span class="o">=</span><span class="n">out_assets</span><span class="p">),</span>
            <span class="n">address_target</span><span class="o">=</span><span class="n">address_target</span><span class="p">,</span>
            <span class="n">datum_target</span><span class="o">=</span><span class="n">datum_target</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">swap_utxo</span><span class="p">(</span>  <span class="c1"># noqa: PLR0913</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">address_source</span><span class="p">:</span> <span class="n">Address</span><span class="p">,</span>
        <span class="n">in_assets</span><span class="p">:</span> <span class="n">Assets</span><span class="p">,</span>
        <span class="n">out_assets</span><span class="p">:</span> <span class="n">Assets</span><span class="p">,</span>
        <span class="n">extra_assets</span><span class="p">:</span> <span class="n">Assets</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">address_target</span><span class="p">:</span> <span class="n">Address</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">datum_target</span><span class="p">:</span> <span class="n">PlutusData</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransactionOutput</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a swap UTXO for the pool.</span>

<span class="sd">        Args:</span>
<span class="sd">            address_source (Address): The source address for the swap.</span>
<span class="sd">            in_assets (Assets): The assets being swapped in.</span>
<span class="sd">            out_assets (Assets): The assets being swapped out.</span>
<span class="sd">            extra_assets (Assets | None, optional): Any additional assets involved.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">            address_target (Address | None, optional): The target address for the swap.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">            datum_target (PlutusData | None, optional): The target datum for the swap.</span>
<span class="sd">            Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple[TransactionOutput, PlutusData]: A tuple containing the created</span>
<span class="sd">            transaction output and the swap datum.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If more than one asset is supplied as input or output.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Basic checks</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">in_assets</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">out_assets</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Only one asset can be supplied as input, &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;and one asset supplied as output.&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">order_datum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">swap_datum</span><span class="p">(</span>
            <span class="n">address_source</span><span class="o">=</span><span class="n">address_source</span><span class="p">,</span>
            <span class="n">in_assets</span><span class="o">=</span><span class="n">in_assets</span><span class="p">,</span>
            <span class="n">out_assets</span><span class="o">=</span><span class="n">out_assets</span><span class="p">,</span>
            <span class="n">extra_assets</span><span class="o">=</span><span class="n">extra_assets</span><span class="p">,</span>
            <span class="n">address_target</span><span class="o">=</span><span class="n">address_target</span><span class="p">,</span>
            <span class="n">datum_target</span><span class="o">=</span><span class="n">datum_target</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">in_assets</span><span class="o">.</span><span class="n">root</span><span class="p">[</span><span class="s2">&quot;lovelace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">in_assets</span><span class="p">[</span><span class="s2">&quot;lovelace&quot;</span><span class="p">]</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">batcher_fee</span><span class="p">(</span>
                <span class="n">in_assets</span><span class="o">=</span><span class="n">in_assets</span><span class="p">,</span>
                <span class="n">out_assets</span><span class="o">=</span><span class="n">out_assets</span><span class="p">,</span>
                <span class="n">extra_assets</span><span class="o">=</span><span class="n">extra_assets</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">quantity</span><span class="p">()</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">deposit</span><span class="p">(</span><span class="n">in_assets</span><span class="o">=</span><span class="n">in_assets</span><span class="p">,</span> <span class="n">out_assets</span><span class="o">=</span><span class="n">out_assets</span><span class="p">)</span><span class="o">.</span><span class="n">quantity</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inline_datum</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">TransactionOutput</span><span class="p">(</span>
                <span class="n">address</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stake_address</span><span class="p">,</span>
                <span class="n">amount</span><span class="o">=</span><span class="n">asset_to_value</span><span class="p">(</span><span class="n">in_assets</span><span class="p">),</span>
                <span class="n">datum</span><span class="o">=</span><span class="n">order_datum</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">TransactionOutput</span><span class="p">(</span>
                <span class="n">address</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stake_address</span><span class="p">,</span>
                <span class="n">amount</span><span class="o">=</span><span class="n">asset_to_value</span><span class="p">(</span><span class="n">in_assets</span><span class="p">),</span>
                <span class="n">datum_hash</span><span class="o">=</span><span class="n">order_datum</span><span class="o">.</span><span class="n">hash</span><span class="p">(),</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">output</span><span class="p">,</span> <span class="n">order_datum</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">pool_policy</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The pool nft policies.</span>

<span class="sd">        This should be the policy or policy+name of any pool nft policy that might be</span>
<span class="sd">        in the pool. Each pool must contain one of the NFTs in the list, and if this</span>
<span class="sd">        is None then no pool NFT check is made.</span>

<span class="sd">        By default, no pool policy is defined.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[List[str]]: list of policy or policy+name of pool nfts or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">lp_policy</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The lp token policies.</span>

<span class="sd">        Some dexs store staked lp tokens in the pool, and this definition is needed to</span>
<span class="sd">        filter out tokens from the assets.</span>

<span class="sd">        This should be the policy or policy+name of lp pool lp policy that might be</span>
<span class="sd">        in the pool. Each pool must contain one of the NFTs in the list, and if this</span>
<span class="sd">        is None then no lp token check is made.</span>

<span class="sd">        By default, no pool policy is defined.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[str]: policy or policy+name of lp tokens</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">extract_dex_nft</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Assets</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract the dex nft from the UTXO.</span>

<span class="sd">        Some DEXs put a DEX nft into the pool UTXO.</span>

<span class="sd">        This function checks to see if the DEX nft is in the UTXO if the DEX policy is</span>
<span class="sd">        defined.</span>

<span class="sd">        If the dex nft is in the values, this value is skipped because it is assumed</span>
<span class="sd">        that this utxo has already been parsed.</span>

<span class="sd">        Args:</span>
<span class="sd">            values: The pool UTXO inputs.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Assets: None or the dex nft.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">assets</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assets&quot;</span><span class="p">]</span>
        <span class="n">dex_policy</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">dex_policy</span><span class="p">()</span>

        <span class="c1"># If no dex policy id defined, return nothing</span>
        <span class="k">if</span> <span class="n">dex_policy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dex_nft</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># If the dex nft is in the values, it&#39;s been parsed already</span>
        <span class="k">elif</span> <span class="s2">&quot;dex_nft&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span>
                <span class="nb">any</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dex_policy</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;dex_nft&quot;</span><span class="p">]</span>
            <span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Invalid DEX NFT&quot;</span>
                <span class="k">raise</span> <span class="n">NotAPoolError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">dex_nft</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;dex_nft&quot;</span><span class="p">]</span>

        <span class="c1"># Check for the dex nft</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nfts</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">asset</span>
                <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">assets</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">asset</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">policy</span><span class="p">)</span> <span class="k">for</span> <span class="n">policy</span> <span class="ow">in</span> <span class="n">dex_policy</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nfts</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: Pool must have one DEX NFT token.&quot;</span>
                <span class="k">raise</span> <span class="n">NotAPoolError</span><span class="p">(</span>
                    <span class="n">msg</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">dex_nft</span> <span class="o">=</span> <span class="n">Assets</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">nfts</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">assets</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">nfts</span><span class="p">[</span><span class="mi">0</span><span class="p">])})</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;dex_nft&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dex_nft</span>

        <span class="k">return</span> <span class="n">dex_nft</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">extract_pool_nft</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Assets</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract the pool nft from the UTXO.</span>

<span class="sd">        Some DEXs put a pool nft into the pool UTXO.</span>

<span class="sd">        This function checks to see if the pool nft is in the UTXO if the DEX policy is</span>
<span class="sd">        defined.</span>

<span class="sd">        If the pool nft is in the values, this value is skipped because it is assumed</span>
<span class="sd">        that this utxo has already been parsed.</span>

<span class="sd">        Args:</span>
<span class="sd">            values: The pool UTXO inputs.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Assets: None or the pool nft.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">assets</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assets&quot;</span><span class="p">]</span>
        <span class="n">pool_policy</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">pool_policy</span><span class="p">()</span>

        <span class="c1"># If no pool policy id defined, return nothing</span>
        <span class="k">if</span> <span class="n">pool_policy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># If the pool nft is in the values, it&#39;s been parsed already</span>
        <span class="k">if</span> <span class="s2">&quot;pool_nft&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span>
                <span class="nb">any</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">pool_policy</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;pool_nft&quot;</span><span class="p">]</span>
            <span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: Invalid pool NFT: </span><span class="si">{</span><span class="n">values</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">raise</span> <span class="n">InvalidPoolError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">pool_nft</span> <span class="o">=</span> <span class="n">Assets</span><span class="p">(</span>
                <span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;pool_nft&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span>
            <span class="p">)</span>

        <span class="c1"># Check for the pool nft</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nfts</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">asset</span>
                <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">assets</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">asset</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">policy</span><span class="p">)</span> <span class="k">for</span> <span class="n">policy</span> <span class="ow">in</span> <span class="n">pool_policy</span><span class="p">)</span>
            <span class="p">]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nfts</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: A pool must have one pool NFT token.&quot;</span>
                <span class="k">raise</span> <span class="n">InvalidPoolError</span><span class="p">(</span>
                    <span class="n">msg</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">pool_nft</span> <span class="o">=</span> <span class="n">Assets</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">nfts</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">assets</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">nfts</span><span class="p">[</span><span class="mi">0</span><span class="p">])})</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;pool_nft&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pool_nft</span>

        <span class="n">assets</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assets&quot;</span><span class="p">]</span>
        <span class="n">pool_id</span> <span class="o">=</span> <span class="n">pool_nft</span><span class="o">.</span><span class="n">unit</span><span class="p">()[</span><span class="nb">len</span><span class="p">(</span><span class="n">pool_policy</span><span class="p">)</span> <span class="p">:]</span>
        <span class="n">lps</span> <span class="o">=</span> <span class="p">[</span><span class="n">asset</span> <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">assets</span> <span class="k">if</span> <span class="n">asset</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">pool_id</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">lp</span> <span class="ow">in</span> <span class="n">lps</span><span class="p">:</span>
            <span class="n">assets</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">lp</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pool_nft</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">extract_lp_tokens</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Assets</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract the lp tokens from the UTXO.</span>

<span class="sd">        Some DEXs put lp tokens into the pool UTXO.</span>

<span class="sd">        Args:</span>
<span class="sd">            values: The pool UTXO inputs.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Assets: None or the pool nft.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">assets</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assets&quot;</span><span class="p">]</span>
        <span class="n">lp_policy</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">lp_policy</span><span class="p">()</span>

        <span class="c1"># If no pool policy id defined, return nothing</span>
        <span class="k">if</span> <span class="n">lp_policy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># If the pool nft is in the values, it&#39;s been parsed already</span>
        <span class="k">if</span> <span class="s2">&quot;lp_tokens&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;lp_tokens&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span>
                <span class="nb">any</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">lp_policy</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;lp_tokens&quot;</span><span class="p">]</span>
            <span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: Pool has invalid LP tokens.&quot;</span>
                <span class="k">raise</span> <span class="n">InvalidPoolError</span><span class="p">(</span>
                    <span class="n">msg</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">lp_tokens</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;lp_tokens&quot;</span><span class="p">]</span>

        <span class="c1"># Check for the pool nft</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nfts</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">asset</span>
                <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">assets</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">asset</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">policy</span><span class="p">)</span> <span class="k">for</span> <span class="n">policy</span> <span class="ow">in</span> <span class="n">lp_policy</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nfts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">lp_tokens</span> <span class="o">=</span> <span class="n">Assets</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">nfts</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">assets</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">nfts</span><span class="p">[</span><span class="mi">0</span><span class="p">])})</span>
                <span class="n">values</span><span class="p">[</span><span class="s2">&quot;lp_tokens&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lp_tokens</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lp_tokens</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">values</span><span class="p">[</span><span class="s2">&quot;lp_tokens&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">lp_tokens</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">skip_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>  <span class="c1"># noqa: ARG003</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;An initial check to determine if parsing should be carried out.</span>

<span class="sd">        Args:</span>
<span class="sd">            values: The pool initialization parameters.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: If this returns True, initialization checks will get skipped.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">post_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Post initialization checks.</span>

<span class="sd">        Args:</span>
<span class="sd">            values: The pool initialization parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">assets</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assets&quot;</span><span class="p">]</span>
        <span class="n">non_ada_assets</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">assets</span> <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="s2">&quot;lovelace&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span> <span class="o">==</span> <span class="n">ASSET_COUNT_TWO</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">non_ada_assets</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ASSET_COUNT_ONE</span><span class="p">:</span>
                <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Pool must only have 1 non-ADA asset: </span><span class="si">{</span><span class="n">values</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">raise</span> <span class="n">InvalidPoolError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span> <span class="o">==</span> <span class="n">ASSET_COUNT_THREE</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">non_ada_assets</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ASSET_COUNT_TWO</span><span class="p">:</span>
                <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Pool must only have 2 non-ADA assets: </span><span class="si">{</span><span class="n">values</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">raise</span> <span class="n">InvalidPoolError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>

            <span class="c1"># Send the ADA token to the end</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assets&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">root</span><span class="p">[</span><span class="s2">&quot;lovelace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assets&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;lovelace&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="s2">&quot;lovelace&quot;</span> <span class="ow">in</span> <span class="n">assets</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Invalid pool, only contains lovelace: assets=</span><span class="si">{</span><span class="n">assets</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">raise</span> <span class="n">NoAssetsError</span><span class="p">(</span>
                    <span class="n">msg</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Pool must have 2 or 3 assets except factor, NFT, and LP tokens: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;assets=</span><span class="si">{</span><span class="n">assets</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">InvalidPoolError</span><span class="p">(</span>
                <span class="n">msg</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">values</span>

    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;before&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">translate_address</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The main validation function called when initialized.</span>

<span class="sd">        Args:</span>
<span class="sd">            values: The pool initialization values.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The parsed/modified pool initialization values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;assets&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assets&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No assets in the pool.&quot;</span>
                <span class="k">raise</span> <span class="n">NoAssetsError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;assets&quot;</span><span class="p">],</span> <span class="n">Assets</span><span class="p">):</span>
                <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Assets</span><span class="p">(</span><span class="o">**</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;assets&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">skip_init</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">values</span>

        <span class="c1"># Parse the pool datum</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">datum</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">pool_datum_class</span><span class="p">()</span><span class="o">.</span><span class="n">from_cbor</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;datum_cbor&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">DeserializeException</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Pool datum could not be deserialized: </span><span class="se">\n</span><span class="s2"> &quot;</span>
                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; error=</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;   tx_hash=</span><span class="si">{</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;tx_hash&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;    datum=</span><span class="si">{</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;datum_cbor&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">NotAPoolError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

        <span class="c1"># To help prevent edge cases, remove pool tokens while running other checks</span>
        <span class="n">pair</span> <span class="o">=</span> <span class="n">Assets</span><span class="p">({})</span>
        <span class="k">if</span> <span class="n">datum</span><span class="o">.</span><span class="n">pool_pair</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">datum</span><span class="o">.</span><span class="n">pool_pair</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">pair</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">token</span><span class="p">:</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assets&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">token</span><span class="p">)})</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="s2">&quot;Pool does not contain expected asset.</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;    Expected: </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;    Actual: </span><span class="si">{</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;assets&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="k">raise</span> <span class="n">InvalidPoolError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">KeyError</span>

        <span class="n">_</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">extract_dex_nft</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

        <span class="n">_</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">extract_lp_tokens</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

        <span class="n">_</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">extract_pool_nft</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

        <span class="c1"># Add the pool tokens back in</span>
        <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assets&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">pair</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">post_init</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">values</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">price</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Decimal</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Price of assets.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A `Tuple[Decimal, Decimal] where the first `Decimal` is the price to buy</span>
<span class="sd">                1 of token B in units of token A, and the second `Decimal` is the price</span>
<span class="sd">                to buy 1 of token A in units of token B.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nat_assets</span> <span class="o">=</span> <span class="n">naturalize_assets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assets</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">nat_assets</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unit_a</span><span class="p">]</span> <span class="o">/</span> <span class="n">nat_assets</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unit_b</span><span class="p">]),</span>
            <span class="p">(</span><span class="n">nat_assets</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unit_b</span><span class="p">]</span> <span class="o">/</span> <span class="n">nat_assets</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unit_a</span><span class="p">]),</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tvl</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Decimal</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the total value locked for the pool.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: Only ADA pool TVL is implemented.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_a</span> <span class="o">!=</span> <span class="s2">&quot;lovelace&quot;</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;tvl for non-ADA pools is not implemented.&quot;</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reserve_a</span><span class="p">)</span> <span class="o">/</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">))</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span>
            <span class="mi">1</span> <span class="o">/</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">),</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.pool_datum" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pool_datum</span><span class="p">:</span> <span class="n">PlutusData</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>The pool state datum.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.pool_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pool_id</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>A unique identifier for the pool.</p>
<p>This is a unique string differentiating this pool from every other pool on the
dex, and is necessary for dexs that have more than one pool for a pair but with
different fee structures.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.price" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">price</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Decimal</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Price of assets.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple[<span title="decimal.Decimal">Decimal</span>, <span title="decimal.Decimal">Decimal</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A <code>Tuple[Decimal, Decimal] where the first</code>Decimal<code>is the price to buy
1 of token B in units of token A, and the second</code>Decimal` is the price
to buy 1 of token A in units of token B.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.tvl" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tvl</span><span class="p">:</span> <span class="n">Decimal</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Return the total value locked for the pool.</p>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>NotImplementedError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Only ADA pool TVL is implemented.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.extract_dex_nft" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_dex_nft</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Extract the dex nft from the UTXO.</p>
<p>Some DEXs put a DEX nft into the pool UTXO.</p>
<p>This function checks to see if the DEX nft is in the UTXO if the DEX policy is
defined.</p>
<p>If the dex nft is in the values, this value is skipped because it is assumed
that this utxo has already been parsed.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>values</code></td>
            <td>
                  <code>dict[str, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The pool UTXO inputs.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Assets</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="charli3_dendrite.dataclasses.models.Assets" href="../models/#charli3_dendrite.dataclasses.models.Assets">Assets</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None or the dex nft.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/charli3_dendrite/dexs/amm/amm_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">extract_dex_nft</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Assets</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract the dex nft from the UTXO.</span>

<span class="sd">    Some DEXs put a DEX nft into the pool UTXO.</span>

<span class="sd">    This function checks to see if the DEX nft is in the UTXO if the DEX policy is</span>
<span class="sd">    defined.</span>

<span class="sd">    If the dex nft is in the values, this value is skipped because it is assumed</span>
<span class="sd">    that this utxo has already been parsed.</span>

<span class="sd">    Args:</span>
<span class="sd">        values: The pool UTXO inputs.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Assets: None or the dex nft.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">assets</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assets&quot;</span><span class="p">]</span>
    <span class="n">dex_policy</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">dex_policy</span><span class="p">()</span>

    <span class="c1"># If no dex policy id defined, return nothing</span>
    <span class="k">if</span> <span class="n">dex_policy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dex_nft</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># If the dex nft is in the values, it&#39;s been parsed already</span>
    <span class="k">elif</span> <span class="s2">&quot;dex_nft&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span>
            <span class="nb">any</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dex_policy</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;dex_nft&quot;</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Invalid DEX NFT&quot;</span>
            <span class="k">raise</span> <span class="n">NotAPoolError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">dex_nft</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;dex_nft&quot;</span><span class="p">]</span>

    <span class="c1"># Check for the dex nft</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nfts</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">asset</span>
            <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">assets</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">asset</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">policy</span><span class="p">)</span> <span class="k">for</span> <span class="n">policy</span> <span class="ow">in</span> <span class="n">dex_policy</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nfts</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: Pool must have one DEX NFT token.&quot;</span>
            <span class="k">raise</span> <span class="n">NotAPoolError</span><span class="p">(</span>
                <span class="n">msg</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">dex_nft</span> <span class="o">=</span> <span class="n">Assets</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">nfts</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">assets</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">nfts</span><span class="p">[</span><span class="mi">0</span><span class="p">])})</span>
        <span class="n">values</span><span class="p">[</span><span class="s2">&quot;dex_nft&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dex_nft</span>

    <span class="k">return</span> <span class="n">dex_nft</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.extract_lp_tokens" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_lp_tokens</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Extract the lp tokens from the UTXO.</p>
<p>Some DEXs put lp tokens into the pool UTXO.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>values</code></td>
            <td>
                  <code>dict[str, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The pool UTXO inputs.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Assets</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="charli3_dendrite.dataclasses.models.Assets" href="../models/#charli3_dendrite.dataclasses.models.Assets">Assets</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None or the pool nft.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/charli3_dendrite/dexs/amm/amm_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">extract_lp_tokens</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Assets</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract the lp tokens from the UTXO.</span>

<span class="sd">    Some DEXs put lp tokens into the pool UTXO.</span>

<span class="sd">    Args:</span>
<span class="sd">        values: The pool UTXO inputs.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Assets: None or the pool nft.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">assets</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assets&quot;</span><span class="p">]</span>
    <span class="n">lp_policy</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">lp_policy</span><span class="p">()</span>

    <span class="c1"># If no pool policy id defined, return nothing</span>
    <span class="k">if</span> <span class="n">lp_policy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># If the pool nft is in the values, it&#39;s been parsed already</span>
    <span class="k">if</span> <span class="s2">&quot;lp_tokens&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;lp_tokens&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span>
            <span class="nb">any</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">lp_policy</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;lp_tokens&quot;</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: Pool has invalid LP tokens.&quot;</span>
            <span class="k">raise</span> <span class="n">InvalidPoolError</span><span class="p">(</span>
                <span class="n">msg</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">lp_tokens</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;lp_tokens&quot;</span><span class="p">]</span>

    <span class="c1"># Check for the pool nft</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nfts</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">asset</span>
            <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">assets</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">asset</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">policy</span><span class="p">)</span> <span class="k">for</span> <span class="n">policy</span> <span class="ow">in</span> <span class="n">lp_policy</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nfts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lp_tokens</span> <span class="o">=</span> <span class="n">Assets</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">nfts</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">assets</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">nfts</span><span class="p">[</span><span class="mi">0</span><span class="p">])})</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;lp_tokens&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lp_tokens</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lp_tokens</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;lp_tokens&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">lp_tokens</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.extract_pool_nft" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_pool_nft</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Extract the pool nft from the UTXO.</p>
<p>Some DEXs put a pool nft into the pool UTXO.</p>
<p>This function checks to see if the pool nft is in the UTXO if the DEX policy is
defined.</p>
<p>If the pool nft is in the values, this value is skipped because it is assumed
that this utxo has already been parsed.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>values</code></td>
            <td>
                  <code>dict[str, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The pool UTXO inputs.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Assets</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="charli3_dendrite.dataclasses.models.Assets" href="../models/#charli3_dendrite.dataclasses.models.Assets">Assets</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None or the pool nft.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/charli3_dendrite/dexs/amm/amm_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">extract_pool_nft</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Assets</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract the pool nft from the UTXO.</span>

<span class="sd">    Some DEXs put a pool nft into the pool UTXO.</span>

<span class="sd">    This function checks to see if the pool nft is in the UTXO if the DEX policy is</span>
<span class="sd">    defined.</span>

<span class="sd">    If the pool nft is in the values, this value is skipped because it is assumed</span>
<span class="sd">    that this utxo has already been parsed.</span>

<span class="sd">    Args:</span>
<span class="sd">        values: The pool UTXO inputs.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Assets: None or the pool nft.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">assets</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assets&quot;</span><span class="p">]</span>
    <span class="n">pool_policy</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">pool_policy</span><span class="p">()</span>

    <span class="c1"># If no pool policy id defined, return nothing</span>
    <span class="k">if</span> <span class="n">pool_policy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># If the pool nft is in the values, it&#39;s been parsed already</span>
    <span class="k">if</span> <span class="s2">&quot;pool_nft&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span>
            <span class="nb">any</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">pool_policy</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;pool_nft&quot;</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: Invalid pool NFT: </span><span class="si">{</span><span class="n">values</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="n">InvalidPoolError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">pool_nft</span> <span class="o">=</span> <span class="n">Assets</span><span class="p">(</span>
            <span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;pool_nft&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span>
        <span class="p">)</span>

    <span class="c1"># Check for the pool nft</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nfts</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">asset</span>
            <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">assets</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">asset</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">policy</span><span class="p">)</span> <span class="k">for</span> <span class="n">policy</span> <span class="ow">in</span> <span class="n">pool_policy</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nfts</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: A pool must have one pool NFT token.&quot;</span>
            <span class="k">raise</span> <span class="n">InvalidPoolError</span><span class="p">(</span>
                <span class="n">msg</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">pool_nft</span> <span class="o">=</span> <span class="n">Assets</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">nfts</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">assets</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">nfts</span><span class="p">[</span><span class="mi">0</span><span class="p">])})</span>
        <span class="n">values</span><span class="p">[</span><span class="s2">&quot;pool_nft&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pool_nft</span>

    <span class="n">assets</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assets&quot;</span><span class="p">]</span>
    <span class="n">pool_id</span> <span class="o">=</span> <span class="n">pool_nft</span><span class="o">.</span><span class="n">unit</span><span class="p">()[</span><span class="nb">len</span><span class="p">(</span><span class="n">pool_policy</span><span class="p">)</span> <span class="p">:]</span>
    <span class="n">lps</span> <span class="o">=</span> <span class="p">[</span><span class="n">asset</span> <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">assets</span> <span class="k">if</span> <span class="n">asset</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">pool_id</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">lp</span> <span class="ow">in</span> <span class="n">lps</span><span class="p">:</span>
        <span class="n">assets</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">lp</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pool_nft</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.lp_policy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">lp_policy</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>The lp token policies.</p>
<p>Some dexs store staked lp tokens in the pool, and this definition is needed to
filter out tokens from the assets.</p>
<p>This should be the policy or policy+name of lp pool lp policy that might be
in the pool. Each pool must contain one of the NFTs in the list, and if this
is None then no lp token check is made.</p>
<p>By default, no pool policy is defined.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>list[str] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[str]: policy or policy+name of lp tokens</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/charli3_dendrite/dexs/amm/amm_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">lp_policy</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The lp token policies.</span>

<span class="sd">    Some dexs store staked lp tokens in the pool, and this definition is needed to</span>
<span class="sd">    filter out tokens from the assets.</span>

<span class="sd">    This should be the policy or policy+name of lp pool lp policy that might be</span>
<span class="sd">    in the pool. Each pool must contain one of the NFTs in the list, and if this</span>
<span class="sd">    is None then no lp token check is made.</span>

<span class="sd">    By default, no pool policy is defined.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[str]: policy or policy+name of lp tokens</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.pool_datum_class" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pool_datum_class</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>The class type for the pool datum.</p>
<p>This property should be implemented to return the specific PlutusData subclass
that represents the datum for the pool.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>type[<span title="pycardano.PlutusData">PlutusData</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>type[PlutusData]: The class type for the pool datum.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/charli3_dendrite/dexs/amm/amm_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">pool_datum_class</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">type</span><span class="p">[</span><span class="n">PlutusData</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The class type for the pool datum.</span>

<span class="sd">    This property should be implemented to return the specific PlutusData subclass</span>
<span class="sd">    that represents the datum for the pool.</span>

<span class="sd">    Returns:</span>
<span class="sd">        type[PlutusData]: The class type for the pool datum.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.pool_policy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pool_policy</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>The pool nft policies.</p>
<p>This should be the policy or policy+name of any pool nft policy that might be
in the pool. Each pool must contain one of the NFTs in the list, and if this
is None then no pool NFT check is made.</p>
<p>By default, no pool policy is defined.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>list[str] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[List[str]]: list of policy or policy+name of pool nfts or None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/charli3_dendrite/dexs/amm/amm_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">pool_policy</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The pool nft policies.</span>

<span class="sd">    This should be the policy or policy+name of any pool nft policy that might be</span>
<span class="sd">    in the pool. Each pool must contain one of the NFTs in the list, and if this</span>
<span class="sd">    is None then no pool NFT check is made.</span>

<span class="sd">    By default, no pool policy is defined.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[List[str]]: list of policy or policy+name of pool nfts or None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.post_init" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">post_init</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Post initialization checks.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>values</code></td>
            <td>
                  <code>dict[str, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The pool initialization parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/charli3_dendrite/dexs/amm/amm_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">post_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Post initialization checks.</span>

<span class="sd">    Args:</span>
<span class="sd">        values: The pool initialization parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">assets</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assets&quot;</span><span class="p">]</span>
    <span class="n">non_ada_assets</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">assets</span> <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="s2">&quot;lovelace&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span> <span class="o">==</span> <span class="n">ASSET_COUNT_TWO</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">non_ada_assets</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ASSET_COUNT_ONE</span><span class="p">:</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Pool must only have 1 non-ADA asset: </span><span class="si">{</span><span class="n">values</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="n">InvalidPoolError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span> <span class="o">==</span> <span class="n">ASSET_COUNT_THREE</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">non_ada_assets</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ASSET_COUNT_TWO</span><span class="p">:</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Pool must only have 2 non-ADA assets: </span><span class="si">{</span><span class="n">values</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="n">InvalidPoolError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>

        <span class="c1"># Send the ADA token to the end</span>
        <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assets&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">root</span><span class="p">[</span><span class="s2">&quot;lovelace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assets&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;lovelace&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="s2">&quot;lovelace&quot;</span> <span class="ow">in</span> <span class="n">assets</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Invalid pool, only contains lovelace: assets=</span><span class="si">{</span><span class="n">assets</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="n">NoAssetsError</span><span class="p">(</span>
                <span class="n">msg</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Pool must have 2 or 3 assets except factor, NFT, and LP tokens: &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;assets=</span><span class="si">{</span><span class="n">assets</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="n">InvalidPoolError</span><span class="p">(</span>
            <span class="n">msg</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">values</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.skip_init" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">skip_init</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>An initial check to determine if parsing should be carried out.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>values</code></td>
            <td>
                  <code>dict[str, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The pool initialization parameters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If this returns True, initialization checks will get skipped.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/charli3_dendrite/dexs/amm/amm_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">skip_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>  <span class="c1"># noqa: ARG003</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An initial check to determine if parsing should be carried out.</span>

<span class="sd">    Args:</span>
<span class="sd">        values: The pool initialization parameters.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: If this returns True, initialization checks will get skipped.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.swap_datum" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">swap_datum</span><span class="p">(</span><span class="n">address_source</span><span class="p">,</span> <span class="n">in_assets</span><span class="p">,</span> <span class="n">out_assets</span><span class="p">,</span> <span class="n">extra_assets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">address_target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">datum_target</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Create a swap datum for the pool.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>address_source</code></td>
            <td>
                  <code><span title="pycardano.Address">Address</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The source address for the swap.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>in_assets</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="charli3_dendrite.dataclasses.models.Assets" href="../models/#charli3_dendrite.dataclasses.models.Assets">Assets</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The assets being swapped in.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>out_assets</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="charli3_dendrite.dataclasses.models.Assets" href="../models/#charli3_dendrite.dataclasses.models.Assets">Assets</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The assets being swapped out.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>extra_assets</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="charli3_dendrite.dataclasses.models.Assets" href="../models/#charli3_dendrite.dataclasses.models.Assets">Assets</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Any additional assets involved.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>address_target</code></td>
            <td>
                  <code><span title="pycardano.Address">Address</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The target address for the swap.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>datum_target</code></td>
            <td>
                  <code><span title="pycardano.PlutusData">PlutusData</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The target datum for the swap.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>PlutusData</code></td>            <td>
                  <code><span title="pycardano.PlutusData">PlutusData</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The created swap datum.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If more than one asset is supplied as input or output.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/charli3_dendrite/dexs/amm/amm_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">swap_datum</span><span class="p">(</span>  <span class="c1"># noqa: PLR0913</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">address_source</span><span class="p">:</span> <span class="n">Address</span><span class="p">,</span>
    <span class="n">in_assets</span><span class="p">:</span> <span class="n">Assets</span><span class="p">,</span>
    <span class="n">out_assets</span><span class="p">:</span> <span class="n">Assets</span><span class="p">,</span>
    <span class="n">extra_assets</span><span class="p">:</span> <span class="n">Assets</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">address_target</span><span class="p">:</span> <span class="n">Address</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">datum_target</span><span class="p">:</span> <span class="n">PlutusData</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PlutusData</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a swap datum for the pool.</span>

<span class="sd">    Args:</span>
<span class="sd">        address_source (Address): The source address for the swap.</span>
<span class="sd">        in_assets (Assets): The assets being swapped in.</span>
<span class="sd">        out_assets (Assets): The assets being swapped out.</span>
<span class="sd">        extra_assets (Assets | None, optional): Any additional assets involved.</span>
<span class="sd">        Defaults to None.</span>
<span class="sd">        address_target (Address | None, optional): The target address for the swap.</span>
<span class="sd">        Defaults to None.</span>
<span class="sd">        datum_target (PlutusData | None, optional): The target datum for the swap.</span>
<span class="sd">        Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        PlutusData: The created swap datum.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If more than one asset is supplied as input or output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">swap_forward</span> <span class="ow">and</span> <span class="n">address_target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>  <span class="c1"># noqa: T201</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> does not support swap forwarding.&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_datum_class</span><span class="p">()</span><span class="o">.</span><span class="n">create_datum</span><span class="p">(</span>
        <span class="n">address_source</span><span class="o">=</span><span class="n">address_source</span><span class="p">,</span>
        <span class="n">in_assets</span><span class="o">=</span><span class="n">in_assets</span><span class="p">,</span>
        <span class="n">out_assets</span><span class="o">=</span><span class="n">out_assets</span><span class="p">,</span>
        <span class="n">batcher_fee</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batcher_fee</span><span class="p">(</span>
            <span class="n">in_assets</span><span class="o">=</span><span class="n">in_assets</span><span class="p">,</span>
            <span class="n">out_assets</span><span class="o">=</span><span class="n">out_assets</span><span class="p">,</span>
            <span class="n">extra_assets</span><span class="o">=</span><span class="n">extra_assets</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">deposit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deposit</span><span class="p">(</span><span class="n">in_assets</span><span class="o">=</span><span class="n">in_assets</span><span class="p">,</span> <span class="n">out_assets</span><span class="o">=</span><span class="n">out_assets</span><span class="p">),</span>
        <span class="n">address_target</span><span class="o">=</span><span class="n">address_target</span><span class="p">,</span>
        <span class="n">datum_target</span><span class="o">=</span><span class="n">datum_target</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.swap_utxo" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">swap_utxo</span><span class="p">(</span><span class="n">address_source</span><span class="p">,</span> <span class="n">in_assets</span><span class="p">,</span> <span class="n">out_assets</span><span class="p">,</span> <span class="n">extra_assets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">address_target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">datum_target</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Create a swap UTXO for the pool.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>address_source</code></td>
            <td>
                  <code><span title="pycardano.Address">Address</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The source address for the swap.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>in_assets</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="charli3_dendrite.dataclasses.models.Assets" href="../models/#charli3_dendrite.dataclasses.models.Assets">Assets</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The assets being swapped in.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>out_assets</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="charli3_dendrite.dataclasses.models.Assets" href="../models/#charli3_dendrite.dataclasses.models.Assets">Assets</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The assets being swapped out.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>extra_assets</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="charli3_dendrite.dataclasses.models.Assets" href="../models/#charli3_dendrite.dataclasses.models.Assets">Assets</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Any additional assets involved.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>address_target</code></td>
            <td>
                  <code><span title="pycardano.Address">Address</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The target address for the swap.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>datum_target</code></td>
            <td>
                  <code><span title="pycardano.PlutusData">PlutusData</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The target datum for the swap.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pycardano.TransactionOutput">TransactionOutput</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[TransactionOutput, PlutusData]: A tuple containing the created</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pycardano.TransactionOutput">TransactionOutput</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>transaction output and the swap datum.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If more than one asset is supplied as input or output.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/charli3_dendrite/dexs/amm/amm_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">swap_utxo</span><span class="p">(</span>  <span class="c1"># noqa: PLR0913</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">address_source</span><span class="p">:</span> <span class="n">Address</span><span class="p">,</span>
    <span class="n">in_assets</span><span class="p">:</span> <span class="n">Assets</span><span class="p">,</span>
    <span class="n">out_assets</span><span class="p">:</span> <span class="n">Assets</span><span class="p">,</span>
    <span class="n">extra_assets</span><span class="p">:</span> <span class="n">Assets</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">address_target</span><span class="p">:</span> <span class="n">Address</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">datum_target</span><span class="p">:</span> <span class="n">PlutusData</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransactionOutput</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a swap UTXO for the pool.</span>

<span class="sd">    Args:</span>
<span class="sd">        address_source (Address): The source address for the swap.</span>
<span class="sd">        in_assets (Assets): The assets being swapped in.</span>
<span class="sd">        out_assets (Assets): The assets being swapped out.</span>
<span class="sd">        extra_assets (Assets | None, optional): Any additional assets involved.</span>
<span class="sd">        Defaults to None.</span>
<span class="sd">        address_target (Address | None, optional): The target address for the swap.</span>
<span class="sd">        Defaults to None.</span>
<span class="sd">        datum_target (PlutusData | None, optional): The target datum for the swap.</span>
<span class="sd">        Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[TransactionOutput, PlutusData]: A tuple containing the created</span>
<span class="sd">        transaction output and the swap datum.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If more than one asset is supplied as input or output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Basic checks</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">in_assets</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">out_assets</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Only one asset can be supplied as input, &quot;</span>
            <span class="o">+</span> <span class="s2">&quot;and one asset supplied as output.&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">order_datum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">swap_datum</span><span class="p">(</span>
        <span class="n">address_source</span><span class="o">=</span><span class="n">address_source</span><span class="p">,</span>
        <span class="n">in_assets</span><span class="o">=</span><span class="n">in_assets</span><span class="p">,</span>
        <span class="n">out_assets</span><span class="o">=</span><span class="n">out_assets</span><span class="p">,</span>
        <span class="n">extra_assets</span><span class="o">=</span><span class="n">extra_assets</span><span class="p">,</span>
        <span class="n">address_target</span><span class="o">=</span><span class="n">address_target</span><span class="p">,</span>
        <span class="n">datum_target</span><span class="o">=</span><span class="n">datum_target</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">in_assets</span><span class="o">.</span><span class="n">root</span><span class="p">[</span><span class="s2">&quot;lovelace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">in_assets</span><span class="p">[</span><span class="s2">&quot;lovelace&quot;</span><span class="p">]</span>
        <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">batcher_fee</span><span class="p">(</span>
            <span class="n">in_assets</span><span class="o">=</span><span class="n">in_assets</span><span class="p">,</span>
            <span class="n">out_assets</span><span class="o">=</span><span class="n">out_assets</span><span class="p">,</span>
            <span class="n">extra_assets</span><span class="o">=</span><span class="n">extra_assets</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">quantity</span><span class="p">()</span>
        <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">deposit</span><span class="p">(</span><span class="n">in_assets</span><span class="o">=</span><span class="n">in_assets</span><span class="p">,</span> <span class="n">out_assets</span><span class="o">=</span><span class="n">out_assets</span><span class="p">)</span><span class="o">.</span><span class="n">quantity</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inline_datum</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">TransactionOutput</span><span class="p">(</span>
            <span class="n">address</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stake_address</span><span class="p">,</span>
            <span class="n">amount</span><span class="o">=</span><span class="n">asset_to_value</span><span class="p">(</span><span class="n">in_assets</span><span class="p">),</span>
            <span class="n">datum</span><span class="o">=</span><span class="n">order_datum</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">TransactionOutput</span><span class="p">(</span>
            <span class="n">address</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stake_address</span><span class="p">,</span>
            <span class="n">amount</span><span class="o">=</span><span class="n">asset_to_value</span><span class="p">(</span><span class="n">in_assets</span><span class="p">),</span>
            <span class="n">datum_hash</span><span class="o">=</span><span class="n">order_datum</span><span class="o">.</span><span class="n">hash</span><span class="p">(),</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">output</span><span class="p">,</span> <span class="n">order_datum</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="charli3_dendrite.dexs.amm.amm_base.AbstractPoolState.translate_address" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">translate_address</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>The main validation function called when initialized.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>values</code></td>
            <td>
                  <code>dict[str, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The pool initialization values.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>dict[str, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The parsed/modified pool initialization values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/charli3_dendrite/dexs/amm/amm_base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;before&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">translate_address</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The main validation function called when initialized.</span>

<span class="sd">    Args:</span>
<span class="sd">        values: The pool initialization values.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The parsed/modified pool initialization values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;assets&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assets&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No assets in the pool.&quot;</span>
            <span class="k">raise</span> <span class="n">NoAssetsError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;assets&quot;</span><span class="p">],</span> <span class="n">Assets</span><span class="p">):</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Assets</span><span class="p">(</span><span class="o">**</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;assets&quot;</span><span class="p">])</span>

    <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">skip_init</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">values</span>

    <span class="c1"># Parse the pool datum</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">datum</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">pool_datum_class</span><span class="p">()</span><span class="o">.</span><span class="n">from_cbor</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;datum_cbor&quot;</span><span class="p">])</span>
    <span class="k">except</span> <span class="p">(</span><span class="n">DeserializeException</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Pool datum could not be deserialized: </span><span class="se">\n</span><span class="s2"> &quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; error=</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;   tx_hash=</span><span class="si">{</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;tx_hash&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;    datum=</span><span class="si">{</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;datum_cbor&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="n">NotAPoolError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="c1"># To help prevent edge cases, remove pool tokens while running other checks</span>
    <span class="n">pair</span> <span class="o">=</span> <span class="n">Assets</span><span class="p">({})</span>
    <span class="k">if</span> <span class="n">datum</span><span class="o">.</span><span class="n">pool_pair</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">datum</span><span class="o">.</span><span class="n">pool_pair</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">pair</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">token</span><span class="p">:</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assets&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">token</span><span class="p">)})</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;Pool does not contain expected asset.</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;    Expected: </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;    Actual: </span><span class="si">{</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;assets&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="n">InvalidPoolError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">KeyError</span>

    <span class="n">_</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">extract_dex_nft</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

    <span class="n">_</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">extract_lp_tokens</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

    <span class="n">_</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">extract_pool_nft</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

    <span class="c1"># Add the pool tokens back in</span>
    <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assets&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">pair</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>

    <span class="bp">cls</span><span class="o">.</span><span class="n">post_init</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">values</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": 1.0}</script>
    
    
      <script src="../assets/javascripts/bundle.471ce7a9.min.js"></script>
      
    
  </body>
</html>